(function(b){var c=function(a,f,e,c,g){this.target=a;this.options=b.extend({host:"https://query.yahooapis.com/v1/public/yql",oauth:null,input:"xml",output:"json",url:f,resource:"",tables:e||"*",params:{},sort:null,offset:0,limit:10,layoutTemplate:"<ul>{entries}</ul>",entryTemplate:"<li>{entry}</li>",effect:"show",tokens:{},error:function(a){console.log(a||"No Data Retrieved")},onData:function(){},onSuccess:function(){}},c||{});this.options.url=[this.options.url,this.options.resource,"?",b.param(this.options.params)].join("");
this.callback=g||this.options.onSuccess};c.INPUTS=["html","xml","json","rss","atom"];c.OUTPUTS=["xml","json"];c.HTML_TAGS="doctype,html,head,title,base,link,meta,style,script,noscript,body,article,nav,aside,section,header,footer,h1-h6,hgroup,address,p,hr,pre,blockquote,ol,ul,li,dl,dt,dd,figure,figcaption,div,table,caption,thead,tbody,tfoot,tr,th,td,col,colgroup,form,fieldset,legend,label,input,button,select,datalist,optgroup,option,textarea,keygen,output,progress,meter,details,summary,command,menu,del,ins,img,iframe,embed,object,param,video,audio,source,canvas,track,map,area,a,em,strong,i,b,u,s,small,abbr,q,cite,dfn,sub,sup,time,code,kbd,samp,var,mark,bdi,bdo,ruby,rt,rp,span,br,wbr".split(",");
c.prototype.load=function(a){this.api=this.options.host;this.query='select {0} from {1} where url="{2}" limit {3} offset {4}';b.inArray(this.options.input,this.INPUTS)||(this.options.input="xml");b.inArray(this.options.output,this.OUTPUTS)||(this.options.output=this.options.input);"string"==b.type(this.options.tables)?this.options.tables=this.options.tables.split(","):b.isArray(this.options.tables)||(this.options.tables="*");this.params={q:this.query.format(this.options.tables.join(","),this.options.input,
this.options.url,this.options.limit,this.options.offset),format:this.options.output,callback:a.name};this.options.sort&&"string"===typeof this.options.sort&&(this.params.q+='|sort("{0}")'.format(this.options.sort));this.request={url:this.api+"?"+b.param(this.params),method:"GET"};this.options.oauth?(this.options.oauth=b.extend({consumer:{key:null,secret:null},signature_method:"HMAC-SHA1",hash_function:function(a,b){return CryptoJS.HmacSHA1(a,b).toString(CryptoJS.enc.Base64)}},{consumer:this.options.oauth}),
b.ajax({url:this.request.url,method:this.request.method,data:OAuth(this.options.oauth).authorize(this.request),success:a})):b.ajax({url:this.request.url,method:this.request.method,success:a})};c.prototype.render=function(){var a=this;this.load(function(c){try{a.feed=c.query.results;a.entries=[];for(var e in a.feed)a.entries=a.entries.concat(a.feed[e].reduce(flattenArray,[]))}catch(d){return a.payload=null,a.entries=[],a.options.error.call(a,d.message)}c=a.generateHTMLForEntries();a.target.append(c.layout);
0!==c.entries.length&&(b.isFunction(a.options.onData)&&a.options.onData.call(a),e=b(c.layout).is("entries")?c.layout:b("entries",c.layout),a.appendEntriesAndApplyEffects(e,c.entries))})};c.prototype.appendEntriesAndApplyEffects=function(a,c){var e=this;b.each(c,function(c,b){var f=e.wrapContent(b);"show"===e.options.effect?a.before(f):(f.css({display:"none"}),a.before(f),e.applyEffect(f,e.options.effect))});a.remove()};c.prototype.generateHTMLForEntries=function(){var a=this,c={entries:[],layout:null};
b(this.entries).each(function(){var b=a.evaluateStringForEntry(a.options.entryTemplate,this);c.entries.push(b)});c.layout=this.options.entryTemplate?this.wrapContent(this.options.layoutTemplate.replace("{entries}","<entries></entries>")):this.wrapContent("<div><entries></entries></div>");return c};c.prototype.applyEffect=function(a,c,b){switch(c){case "slide":a.slideDown("slow",b);break;case "slideFast":a.slideDown(b);break;case "slideSynced":this.effectQueue.push({element:a,effect:"slide"});break;
case "slideFastSynced":this.effectQueue.push({element:a,effect:"slideFast"})}};c.prototype.executeEffectQueue=function(a){var c=this,b=function(){var d=c.effectQueue.pop();d?c.applyEffect(d.element,d.effect,b):a&&a()};b()};c.prototype.wrapContent=function(a){return 0!==b.trim(a).indexOf("<")?b("<div>"+a+"</div>"):b(a)};c.prototype.evaluateStringForEntry=function(a,c){var e=this,d=a;b(a.match(/(\{.*?})/g)).each(function(){var a=this.toString();d=d.replace(a,e.getValueForToken(a,c))});return d};c.prototype.getTokenMap=
function(a){this.feedTokens||(this.feedTokens=this.entries.map(flattenObject));return b.extend({feed:this.feedTokens,index:b.inArray(a,this.entries),totalEntries:this.entries.length},this.options.tokens)};c.prototype.getValueForToken=function(a,c){var b=this.getTokenMap(c),d=a.replace(/[\{\}]/g,""),d=b.feed[b.index][d]?b.feed[b.index][d]:b[d];if("undefined"!==typeof d)return"function"===typeof d?d(c,b):d;throw Error("Unknown token: "+a+", url:"+this.url);};b.fn.yql=function(a,b,e,d){(new c(this,a,
b,e,d)).render();return this}})(jQuery);String.prototype.format=String.prototype.format||function(){var b=this.toString();if(arguments.length){var c=typeof arguments[0],a,c="string"===c||"number"===c?Array.prototype.slice.call(arguments):arguments[0];for(a in c)b=b.replace(RegExp("\\{"+a+"\\}","gi"),c[a])}return b};Object.resolve=function(b,c){return b.split(".").reduce(function(a,b){return a?a[b]:void 0},c||self)};
function flattenObject(b){return Object.keys(b).reduce(function(c,a){switch(Object.prototype.toString.call(b[a])){case "[object Date]":c[a]=b[a].toString();break;case "[object Object]":if(b[a]){var f=flattenObject(b[a]);Object.keys(f).forEach(function(b){c[a+"."+b]=f[b]})}break;case "[object Array]":console.log(b[a]);default:c[a]=b[a]}return c},{})}function flattenArray(b,c){return Array.isArray(c)?b.concat(flattenArray(c)):b.concat([flattenObject(c)])};
